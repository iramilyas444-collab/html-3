<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sapphire-style Advanced Store (Single File)</title>
<style>
  :root{
    --bg:#fff; --muted:#6b7280; --accent:#0f172a; --accent-2:#111827;
    --card:#fbfbfd; --glass:rgba(255,255,255,0.6);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background:var(--bg);color:#111827;-webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;line-height:1.4;
  }

  /* ---------- Top announcement ---------- */
  .announce{
    background:#0b1220;color:#fff;text-align:center;padding:6px 12px;font-size:13px;
  }

  /* ---------- Header ---------- */
  header.site-header{
    position:sticky;top:0;z-index:60;
    background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
    backdrop-filter: blur(6px);
    border-bottom:1px solid rgba(15,23,42,0.06);
  }
  .nav-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;gap:12px;}
  .brand{font-weight:700;letter-spacing:2px;font-size:18px}
  .nav-left{display:flex;align-items:center;gap:18px}
  .nav-links{display:flex;gap:14px;align-items:center}
  .nav-links > .link{position:relative;padding:10px 6px;color:var(--accent-2);cursor:pointer;font-size:14px}
  .nav-links > .link:hover{color:#000}

  /* mega menu */
  .mega{
    position:absolute;left:0;top:100%;transform:translateY(10px);opacity:0;visibility:hidden;
    background:#fff;padding:18px;border-radius:12px;box-shadow:0 20px 40px rgba(2,6,23,0.08);
    width:900px;display:grid;grid-template-columns:repeat(4,1fr);gap:18px;
    transition:all .18s ease;
  }
  .nav-links > .link:hover .mega,
  .nav-links > .link:focus-within .mega{opacity:1;visibility:visible;transform:translateY(0)}
  .mega h4{font-size:13px;margin:0 0 8px;color:#111827}
  .mega a{display:block;padding:6px 0;color:var(--muted);text-decoration:none;font-size:14px}
  .mega a:hover{color:#000}

  /* header icons */
  .icons{display:flex;gap:10px;align-items:center}
  .icon-btn{background:transparent;border:0;padding:8px;border-radius:8px;cursor:pointer}
  .cart-badge{background:#ef4444;color:#fff;padding:2px 7px;border-radius:999px;font-size:12px;display:inline-block;margin-left:6px}

  /* ---------- Mobile header ---------- */
  .mobile-toggle{display:none}
  .mobile-brand{display:none}

  /* ---------- Hero carousel ---------- */
  .hero{
    max-width:1200px;margin:14px auto;padding:0 16px;position:relative;overflow:hidden;border-radius:12px;
  }
  .hero-slides{height:460px;border-radius:12px;position:relative;overflow:hidden}
  .hero-slide{position:absolute;inset:0;background-size:cover;background-position:center;display:flex;align-items:flex-end;padding:36px;border-radius:12px;transition:all .6s ease;opacity:0;transform:scale(.98)}
  .hero-slide.active{opacity:1;transform:scale(1)}
  .hero-card{background:linear-gradient(180deg, rgba(0,0,0,0.05), rgba(0,0,0,0.35));color:#fff;padding:22px;border-radius:12px;max-width:520px}
  .hero h1{font-size:30px;margin:0 0 8px}
  .hero p{margin:0 0 14px;color:rgba(255,255,255,0.9)}
  .hero .controls{position:absolute;right:20px;bottom:20px;display:flex;gap:8px}
  .dot{width:10px;height:10px;border-radius:999px;background:#fff;opacity:.45}
  .dot.active{opacity:1;transform:scale(1.05)}

  /* ---------- Main layout ---------- */
  .stage{max-width:1200px;margin:22px auto;display:grid;grid-template-columns:260px 1fr;gap:22px;padding:0 16px}
  /* filter column */
  .filters{background:#fff;padding:16px;border-radius:12px;border:1px solid rgba(2,6,23,0.04)}
  .filter-group{margin-bottom:14px}
  .filter-group h5{font-size:13px;margin-bottom:8px;color:var(--accent-2)}
  .chip{display:inline-flex;padding:8px 10px;border-radius:999px;margin:6px 6px 6px 0;background:#f3f4f6;border:1px solid rgba(15,23,42,0.04);cursor:pointer;font-size:13px}
  .chip.active{background:#111827;color:#fff}

  /* product grid */
  .products-wrap{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  .product{
    background:var(--card);border-radius:12px;padding:10px;border:1px solid rgba(2,6,23,0.04);overflow:hidden;display:flex;flex-direction:column;
  }
  .thumb{height:300px;border-radius:10px;overflow:hidden;background:#e6e7eb}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .p-body{padding:10px 6px;flex:1;display:flex;flex-direction:column}
  .p-title{font-weight:600;font-size:15px;color:#0f172a;margin-bottom:8px}
  .p-price{font-weight:700;color:#111827;margin-top:auto}
  .p-actions{display:flex;gap:8px;margin-top:8px}
  .btn{padding:9px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn.primary{background:#111827;color:#fff}
  .btn.ghost{background:transparent;border:1px solid rgba(15,23,42,0.06)}

  /* quick view button overlay */
  .thumb .quick{position:absolute;right:12px;top:12px;background:rgba(255,255,255,0.95);padding:8px;border-radius:8px;font-size:13px;cursor:pointer;display:none}
  .product:hover .thumb .quick{display:block}

  /* ---------- Cart drawer ---------- */
  .cart-drawer{position:fixed;right:0;top:0;bottom:0;width:380px;background:#fff;box-shadow:-30px 0 60px rgba(2,6,23,0.12);z-index:80;padding:16px;transform:translateX(110%);transition:transform .28s ease;display:flex;flex-direction:column}
  .cart-drawer.open{transform:translateX(0)}
  .cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .cart-items{flex:1;overflow:auto;padding-right:6px}
  .cart-item{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid rgba(2,6,23,0.04)}
  .cart-item img{width:72px;height:72px;object-fit:cover;border-radius:8px}
  .qty{display:flex;gap:8px;align-items:center}
  .qty button{border:1px solid rgba(2,6,23,0.06);padding:2px 8px;border-radius:6px;background:#fff;cursor:pointer}

  .cart-footer{padding-top:10px;border-top:1px solid rgba(2,6,23,0.04)}
  .total-row{display:flex;justify-content:space-between;font-weight:700;margin-bottom:12px}

  /* ---------- Modal Quick-view ---------- */
  .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:none;align-items:center;justify-content:center;z-index:90}
  .modal-backdrop.open{display:flex}
  .modal{background:#fff;padding:18px;border-radius:12px;max-width:900px;width:95%;display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .modal img{width:100%;height:420px;object-fit:cover;border-radius:8px}
  .modal .info h3{margin:0 0 6px}
  .modal .info p{color:var(--muted)}
  .colors-row{display:flex;gap:8px;margin:8px 0}
  .color-dot{width:28px;height:28px;border-radius:999px;border:1px solid rgba(2,6,23,0.06);cursor:pointer}

  /* ---------- Search overlay ---------- */
  .search-overlay{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:flex-start;padding-top:60px;z-index:85}
  .search-overlay.open{display:flex}
  .search-panel{background:#fff;margin:0 auto;padding:18px;border-radius:10px;width:min(880px,95%);box-shadow:0 20px 40px rgba(2,6,23,0.12)}
  .search-input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);font-size:16px}
  .suggests{margin-top:8px}
  .suggests li{padding:8px 10px;border-radius:8px;cursor:pointer}
  .suggests li:hover{background:#f8fafc}

  /* ---------- Footer ---------- */
  footer{max-width:1200px;margin:24px auto;padding:22px 16px;color:var(--muted);font-size:14px}

  /* ---------- Responsive ---------- */
  @media (max-width: 980px){
    .stage{grid-template-columns:1fr;min-width:0}
    .products-wrap{grid-template-columns:repeat(2,1fr)}
    .mega{width:92vw;left:0;right:0;margin:auto}
  }
  @media (max-width:640px){
    .hero-slides{height:320px}
    .products-wrap{grid-template-columns:1fr}
    .nav-links{display:none}
    .mobile-toggle{display:block}
    .mobile-brand{display:block}
    .brand{display:none}
    .cart-drawer{width:100%;max-width:420px}
  }
</style>
</head>
<body>
  <div class="announce">Free shipping over Rs. 3,000 • Easy 14-day returns</div>

  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="nav-inner">
      <div class="nav-left">
        <button class="mobile-toggle icon-btn" aria-label="open menu" id="mobileOpen">☰</button>
        <div class="brand">SAPPHIRA</div>
        <nav class="nav-links" aria-label="Main">
          <div class="link" tabindex="0">Women
            <div class="mega" role="menu" aria-hidden="true">
              <div>
                <h4>Unstitched</h4>
                <a href="#">Lawn</a><a href="#">Cotton</a><a href="#">Embroidered</a>
              </div>
              <div>
                <h4>Ready to Wear</h4>
                <a href="#">2-Piece</a><a href="#">Pret</a><a href="#">Dresses</a>
              </div>
              <div>
                <h4>Accessories</h4>
                <a href="#">Bags</a><a href="#">Shawls</a><a href="#">Jewellery</a>
              </div>
              <div>
                <h4>Featured</h4>
                <a href="#">Winter Drop</a><a href="#">Luxe Capsule</a>
              </div>
            </div>
          </div>
          <div class="link" tabindex="0">Men
            <div class="mega" role="menu" aria-hidden="true">
              <div><h4>Eastern</h4><a href="#">Kurta</a><a href="#">Shalwar</a></div>
              <div><h4>Western</h4><a href="#">Shirts</a><a href="#">Denim</a></div>
              <div><h4>Footwear</h4><a href="#">Loafers</a><a href="#">Sneakers</a></div>
              <div><h4>Featured</h4><a href="#">Form & Function</a></div>
            </div>
          </div>
          <div class="link" tabindex="0">Home & Living</div>
          <div class="link" tabindex="0">Sale</div>
        </nav>
      </div>

      <div class="icons" role="toolbar" aria-label="Site actions">
        <div class="mobile-brand">SAPPHIRA</div>
        <button class="icon-btn" id="searchBtn" title="Search" aria-label="Search site">🔍</button>
        <button class="icon-btn" id="accountBtn" title="Account" aria-label="Account">👤</button>
        <button class="icon-btn" id="cartBtn" title="Cart" aria-label="Open cart">🛒 <span id="cartCount" class="cart-badge" style="display:none">0</span></button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <main>
    <section class="hero">
      <div class="hero-slides" id="hero">
        <div class="hero-slide active" style="background-image:url('https://picsum.photos/id/1011/2000/1000')">
          <div class="hero-card">
            <div style="font-size:12px;letter-spacing:2px">NEW ARRIVALS</div>
            <h1>Winter 2025 Edit</h1>
            <p>Tailored silhouettes, tactile textures — curated neutrals.</p>
            <div style="display:flex;gap:10px">
              <button class="btn primary" onclick="scrollToShop()">Shop Women</button>
              <button class="btn ghost" onclick="scrollToShop()">Shop Men</button>
            </div>
          </div>
        </div>

        <div class="hero-slide" style="background-image:url('https://picsum.photos/id/1005/2000/1000')">
          <div class="hero-card">
            <div style="font-size:12px;letter-spacing:2px">EDIT</div>
            <h1>Evening Capsule</h1>
            <p>Limited pieces — satin, organza & handcrafted trims.</p>
            <div style="display:flex;gap:10px">
              <button class="btn primary" onclick="scrollToShop()">Explore</button>
            </div>
          </div>
        </div>

        <div class="controls" style="position:absolute;right:20px;bottom:20px">
          <div id="dots" style="display:flex;gap:8px"></div>
        </div>
      </div>
    </section>

    <!-- Stage -->
    <section class="stage" id="shopArea">
      <!-- Filters -->
      <aside class="filters" aria-label="Filters">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <strong>Filters</strong>
          <button class="btn ghost" id="clearFilters">Clear</button>
        </div>

        <div class="filter-group">
          <h5>Category</h5>
          <div>
            <button class="chip active" data-filter-type="category" data-filter-value="all">All</button>
            <button class="chip" data-filter-type="category" data-filter-value="women">Women</button>
            <button class="chip" data-filter-type="category" data-filter-value="men">Men</button>
            <button class="chip" data-filter-type="category" data-filter-value="home">Home</button>
          </div>
        </div>

        <div class="filter-group">
          <h5>Price</h5>
          <div>
            <button class="chip" data-filter-type="price" data-filter-value="0-3000">Rs. 0 – 3,000</button>
            <button class="chip" data-filter-type="price" data-filter-value="3001-6000">Rs. 3,001 – 6,000</button>
            <button class="chip" data-filter-type="price" data-filter-value="6001-12000">Rs. 6,001 – 12,000</button>
          </div>
        </div>

        <div class="filter-group">
          <h5>Color</h5>
          <div>
            <button class="chip" data-filter-type="color" data-filter-value="beige">Beige</button>
            <button class="chip" data-filter-type="color" data-filter-value="black">Black</button>
            <button class="chip" data-filter-type="color" data-filter-value="olive">Olive</button>
            <button class="chip" data-filter-type="color" data-filter-value="grey">Grey</button>
          </div>
        </div>

        <div style="margin-top:14px;font-size:13px;color:var(--muted)">
          <strong>Sort</strong>
          <div style="margin-top:8px">
            <select id="sortBy" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06)">
              <option value="featured">Featured</option>
              <option value="price-asc">Price: Low → High</option>
              <option value="price-desc">Price: High → Low</option>
              <option value="rating">Rating</option>
            </select>
          </div>
        </div>
      </aside>

      <!-- Products -->
      <section>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <h2 style="margin:0">Featured Edits</h2>
          <div style="display:flex;gap:12px;align-items:center">
            <input id="miniSearch" placeholder="Search products..." style="padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06)" />
            <button class="btn ghost" id="openFilters" onclick="document.getElementById('openFilters')">Filters</button>
          </div>
        </div>

        <div class="products-wrap" id="productsGrid" aria-live="polite">
          <!-- JS injected products -->
        </div>

        <div style="margin-top:18px;display:flex;justify-content:center">
          <button class="btn ghost" id="loadMore">Load more</button>
        </div>
      </section>
    </section>

    <footer>
      © <span id="year"></span> Sapphira • PKR • EN
    </footer>
  </main>

  <!-- Cart Drawer -->
  <aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
    <div class="cart-header">
      <h3>Your Cart</h3>
      <div>
        <button class="btn ghost" id="clearCart">Clear</button>
        <button class="btn" id="closeCart">Close</button>
      </div>
    </div>

    <div class="cart-items" id="cartItems"></div>

    <div class="cart-footer">
      <div class="total-row">
        <div>Subtotal</div>
        <div id="cartSubtotal">Rs. 0</div>
      </div>
      <div style="font-size:13px;color:var(--muted)">Shipping calculated at checkout</div>
      <div style="margin-top:12px">
        <button class="btn primary" style="width:100%" id="checkoutBtn">Checkout</button>
      </div>
    </div>
  </aside>

  <!-- Quick-view Modal -->
  <div class="modal-backdrop" id="quickModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="qTitle">
      <div>
        <img id="qImg" src="" alt="Product" />
      </div>
      <div class="info">
        <h3 id="qTitle"></h3>
        <div style="color:var(--muted);margin-bottom:8px" id="qDesc"></div>
        <div style="margin-bottom:8px"><strong id="qPrice"></strong></div>
        <div class="colors-row" id="qColors"></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn primary" id="qAdd">Add to cart</button>
          <button class="btn ghost" id="qWishlist">Wishlist</button>
        </div>
        <div style="margin-top:12px;color:var(--muted);font-size:13px">
          <div id="qSku"></div>
          <div id="qCare" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search overlay -->
  <div class="search-overlay" id="searchOverlay" aria-hidden="true">
    <div class="search-panel" role="search">
      <div style="display:flex;gap:8px;align-items:center">
        <input id="bigSearch" class="search-input" placeholder="Search products, e.g., kurta, lawn, pret..." />
        <button class="btn ghost" id="closeSearch">Close</button>
      </div>
      <ul class="suggests" id="suggests"></ul>
    </div>
  </div>

<script>
/* =========================
   Data & State
   ========================= */
const PRODUCTS = [
  {id:1,title:"Embroidered Lawn – Sand",price:4490,category:"women",color:"beige",rating:4.7,img:"https://picsum.photos/id/1012/800/800",desc:"Premium lawn with detailed embroidery",sku:"EL-SND-001"},
  {id:2,title:"Printed Kurta – Olive",price:3890,category:"women",color:"olive",rating:4.4,img:"https://picsum.photos/id/1003/800/800",desc:"Lightweight printed kurta",sku:"PK-OLV-002"},
  {id:3,title:"2-Piece Set – Dawn Grey",price:5990,category:"women",color:"grey",rating:4.6,img:"https://picsum.photos/id/1025/800/800",desc:"Cozy 2-piece set",sku:"2PS-DG-003"},
  {id:4,title:"Pret Luxe – Noir Dress",price:9990,category:"women",color:"black",rating:4.9,img:"https://picsum.photos/id/1016/800/800",desc:"Evening pret dress",sku:"PL-NR-004"},
  {id:5,title:"Men’s Kurta – Ecru",price:4290,category:"men",color:"beige",rating:4.3,img:"https://picsum.photos/id/1006/800/800",desc:"Classic men’s kurta",sku:"MK-EC-005"},
  {id:6,title:"Co-ords – Soft Beige",price:6390,category:"women",color:"beige",rating:4.5,img:"https://picsum.photos/id/1027/800/800",desc:"Matching co-ords set",sku:"CO-SB-006"},
  {id:7,title:"Home Runner – Clay",price:1990,category:"home",color:"beige",rating:4.2,img:"https://picsum.photos/id/1035/800/800",desc:"Handloom table runner",sku:"HR-CL-007"},
  {id:8,title:"Men’s Shirt – Navy",price:3290,category:"men",color:"black",rating:4.1,img:"https://picsum.photos/id/1001/800/800",desc:"Casual navy shirt",sku:"MS-NV-008"},
  // ... add more products or load via API
];

let state = {
  filters: {category: "all", price: null, color: null},
  sortBy: "featured",
  search: "",
  cart: JSON.parse(localStorage.getItem("sapphira_cart")||"{}"),
  shownCount: 6
};

/* =========================
   Utilities
   ========================= */
function money(n){ return "Rs. " + Number(n).toLocaleString(); }
function saveCart(){ localStorage.setItem("sapphira_cart", JSON.stringify(state.cart)); updateCartUI(); }
function getCartCount(){ return Object.values(state.cart).reduce((s,i)=>s+(i.qty||0),0); }
function calcSubtotal(){ return Object.values(state.cart).reduce((s,i)=>s + (i.price * i.qty), 0); }

/* =========================
   Render products
   ========================= */
const grid = document.getElementById("productsGrid");
function renderProducts(){
  // filter & sort
  let out = PRODUCTS.slice();

  // search
  const q = state.search.trim().toLowerCase();
  if(q) out = out.filter(p => p.title.toLowerCase().includes(q) || (p.desc && p.desc.toLowerCase().includes(q)));

  // category
  if(state.filters.category && state.filters.category !== "all") out = out.filter(p => p.category===state.filters.category);

  // price
  if(state.filters.price){
    const [min,max] = state.filters.price.split("-").map(Number);
    out = out.filter(p => p.price >= min && p.price <= max);
  }

  // color
  if(state.filters.color) out = out.filter(p => p.color === state.filters.color);

  // sort
  if(state.sortBy === "price-asc") out.sort((a,b)=>a.price-b.price);
  else if(state.sortBy === "price-desc") out.sort((a,b)=>b.price-a.price);
  else if(state.sortBy === "rating") out.sort((a,b)=>b.rating-b.rating);
  // featured default = keep as is

  // limit shown
  const shown = out.slice(0, state.shownCount);

  grid.innerHTML = "";
  shown.forEach(p => {
    const card = document.createElement("article");
    card.className = "product";
    card.innerHTML = `
      <div style="position:relative" class="thumb">
        <img src="${p.img}" alt="${escapeHtml(p.title)}" />
        <button class="quick" data-id="${p.id}">Quick view</button>
      </div>
      <div class="p-body">
        <div class="p-title">${escapeHtml(p.title)}</div>
        <div style="color:var(--muted);font-size:13px">${escapeHtml(p.desc)}</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:12px">
          <div class="p-price">${money(p.price)}</div>
          <div style="font-size:13px;color:var(--muted)">⭐ ${p.rating}</div>
        </div>
        <div class="p-actions">
          <button class="btn primary addBtn" data-id="${p.id}">Add to cart</button>
          <button class="btn ghost viewBtn" data-id="${p.id}">View</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });

  // if no results
  if(out.length === 0){
    grid.innerHTML = "<div style='padding:30px;background:#fff;border-radius:10px;border:1px solid rgba(2,6,23,0.04)'>No products found.</div>";
  }

  // load more visibility
  document.getElementById("loadMore").style.display = out.length > state.shownCount ? "inline-block" : "none";

  // attach listeners
  document.querySelectorAll(".addBtn").forEach(b => b.onclick = e => addToCart(Number(e.currentTarget.dataset.id)));
  document.querySelectorAll(".viewBtn, .quick").forEach(b => b.onclick = e => openQuickView(Number(e.currentTarget.dataset.id)));
}

/* escape for safety in titles/descriptions */
function escapeHtml(unsafe){
  return unsafe.replace(/[&<"']/g, m => ({'&':'&amp;','<':'&lt;','"':'&quot;',"'":'&#039;'}[m]));
}

/* =========================
   Filters UI
   ========================= */
document.querySelectorAll(".chip").forEach(ch => {
  ch.addEventListener("click", () => {
    const type = ch.dataset.filterType, val = ch.dataset.filterValue;
    // toggle active
    // Clear previous active for same filter type except category allows 'all'
    document.querySelectorAll(`.chip[data-filter-type="${type}"]`).forEach(x=>x.classList.remove("active"));
    ch.classList.add("active");
    if(type === "price") state.filters.price = val;
    if(type === "category") state.filters.category = val;
    if(type === "color") state.filters.color = val;
    if(ch.dataset.filterValue === "all") state.filters = {...state.filters, category: "all"};
    renderProducts();
  });
});

document.getElementById("clearFilters").addEventListener("click", () => {
  state.filters = {category:"all", price:null, color:null};
  document.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
  document.querySelector(`.chip[data-filter-value="all"]`).classList.add("active");
  document.getElementById("sortBy").value = "featured";
  state.sortBy = "featured";
  renderProducts();
});

/* sort */
document.getElementById("sortBy").addEventListener("change", (e) => {
  state.sortBy = e.target.value;
  renderProducts();
});

/* mini search */
document.getElementById("miniSearch").addEventListener("input", (e) => {
  state.search = e.target.value;
  renderProducts();
});

/* load more */
document.getElementById("loadMore").addEventListener("click", () => {
  state.shownCount += 6;
  renderProducts();
});

/* scroll to shop */
function scrollToShop(){ const el = document.getElementById("shopArea"); el.scrollIntoView({behavior:"smooth"}); }

/* =========================
   Cart functions
   ========================= */
function addToCart(id, qty=1){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  if(!state.cart[id]) state.cart[id] = {...p, qty:0};
  state.cart[id].qty += qty;
  saveCart();
  openCart();
  flashCartCount();
}

function removeFromCart(id){
  delete state.cart[id];
  saveCart();
}

function changeQty(id, delta){
  if(!state.cart[id]) return;
  state.cart[id].qty = Math.max(0, state.cart[id].qty + delta);
  if(state.cart[id].qty === 0) removeFromCart(id);
  saveCart();
}

function updateCartUI(){
  // count
  const count = getCartCount();
  const badge = document.getElementById("cartCount");
  if(count>0){ badge.style.display="inline-block"; badge.textContent = count; } else badge.style.display="none";

  // items
  const container = document.getElementById("cartItems");
  container.innerHTML = "";
  Object.values(state.cart).forEach(item => {
    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
      <img src="${item.img}" alt="${escapeHtml(item.title)}">
      <div style="flex:1">
        <div style="font-weight:600">${escapeHtml(item.title)}</div>
        <div style="color:var(--muted);font-size:13px">${money(item.price)}</div>
        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
          <div class="qty">
            <button data-id="${item.id}" class="qty-minus">−</button>
            <div style="padding:6px 8px;border-radius:6px;border:1px solid rgba(2,6,23,0.04)">${item.qty}</div>
            <button data-id="${item.id}" class="qty-plus">+</button>
          </div>
          <button class="btn ghost remove" data-id="${item.id}">Remove</button>
        </div>
      </div>
    `;
    container.appendChild(div);
  });

  // attach qty listeners
  container.querySelectorAll(".qty-minus").forEach(b => b.onclick = e => { changeQty(Number(e.currentTarget.dataset.id), -1); });
  container.querySelectorAll(".qty-plus").forEach(b => b.onclick = e => { changeQty(Number(e.currentTarget.dataset.id), +1); });
  container.querySelectorAll(".remove").forEach(b => b.onclick = e => { removeFromCart(Number(e.currentTarget.dataset.id)); });

  document.getElementById("cartSubtotal").textContent = money(calcSubtotal());
}

/* cart drawer open/close */
const cartDrawer = document.getElementById("cartDrawer");
document.getElementById("cartBtn").addEventListener("click", openCart);
document.getElementById("closeCart").addEventListener("click", closeCart);
document.getElementById("clearCart").addEventListener("click", () => { state.cart = {}; saveCart(); });

function openCart(){ cartDrawer.classList.add("open"); cartDrawer.setAttribute("aria-hidden","false"); updateCartUI(); }
function closeCart(){ cartDrawer.classList.remove("open"); cartDrawer.setAttribute("aria-hidden","true"); }

/* quick flash */
function flashCartCount(){
  const el = document.getElementById("cartCount");
  el.animate([{transform:"scale(1)"},{transform:"scale(1.18)"},{transform:"scale(1)"}], {duration:350});
}

/* init cart on load */
updateCartUI();

/* =========================
   Quick view modal
   ========================= */
const modal = document.getElementById("quickModal");
function openQuickView(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  document.getElementById("qImg").src = p.img;
  document.getElementById("qTitle").textContent = p.title;
  document.getElementById("qDesc").textContent = p.desc;
  document.getElementById("qPrice").textContent = money(p.price);
  document.getElementById("qSku").textContent = "SKU: " + p.sku;
  document.getElementById("qCare").textContent = "Care: Hand wash cold, dry shade.";
  document.getElementById("qColors").innerHTML = `<div class="color-dot" style="background:${p.color==='black'?'#111':'#ddd'}"></div>`;
  document.getElementById("qAdd").onclick = () => { addToCart(id,1); closeQuick(); };
  document.getElementById("qWishlist").onclick = ()=>{ alert("Added to wishlist (demo)"); };
  modal.classList.add("open"); modal.setAttribute("aria-hidden","false");
}
function closeQuick(){ modal.classList.remove("open"); modal.setAttribute("aria-hidden","true"); }
modal.addEventListener("click", (e) => { if(e.target === modal) closeQuick(); });

/* =========================
   Search overlay with suggestions
   ========================= */
const searchOverlay = document.getElementById("searchOverlay");
document.getElementById("searchBtn").addEventListener("click", ()=>{ searchOverlay.classList.add("open"); document.getElementById("bigSearch").focus(); });
document.getElementById("closeSearch").addEventListener("click", ()=>{ searchOverlay.classList.remove("open"); });
document.getElementById("bigSearch").addEventListener("input", (e)=> {
  const q = e.target.value.trim().toLowerCase();
  const sug = document.getElementById("suggests");
  sug.innerHTML = "";
  if(!q) return;
  const matches = PRODUCTS.filter(p => p.title.toLowerCase().includes(q) || (p.desc && p.desc.toLowerCase().includes(q))).slice(0,6);
  matches.forEach(m => {
    const li = document.createElement("li");
    li.textContent = m.title + " — " + money(m.price);
    li.onclick = ()=>{ state.search = m.title; document.getElementById("miniSearch").value = m.title; searchOverlay.classList.remove("open"); renderProducts(); };
    sug.appendChild(li);
  });
});

/* mini search entry triggers overlay results too */
document.getElementById("miniSearch").addEventListener("keyup", (e)=> {
  state.search = e.target.value;
  renderProducts();
});

/* =========================
   Small mobile menu (offcanvas)
   ========================= */
const mobileOpen = document.getElementById("mobileOpen");
mobileOpen.addEventListener("click", ()=> {
  // simple mobile menu using prompt for demo; replace with nice offcanvas if you like
  const choices = ["Women","Men","Home & Living","Sale"];
  const choice = prompt("Open section: " + choices.join(", "));
  if(choice) alert("Open " + choice + " (demo)");
});

/* =========================
   Hero carousel
   ========================= */
(function initHero(){
  const slides = Array.from(document.querySelectorAll(".hero-slide"));
  const dots = document.getElementById("dots");
  slides.forEach((s, idx) => {
    const d = document.createElement("div");
    d.className = "dot" + (idx===0?" active":"");
    d.onclick = ()=> go(idx);
    dots.appendChild(d);
  });
  let i=0, timer;
  function go(idx){
    slides[i].classList.remove("active");
    dots.children[i].classList.remove("active");
    i = idx;
    slides[i].classList.add("active");
    dots.children[i].classList.add("active");
    reset();
  }
  function next(){ go((i+1)%slides.length); }
  function reset(){ clearInterval(timer); timer = setInterval(next, 5000); }
  reset();
})();

/* =========================
   Header interactions, year, initial render
   ========================= */
document.getElementById("year").textContent = new Date().getFullYear();
document.getElementById("cartBtn").addEventListener("click", ()=>{ openCart(); });
document.getElementById("checkoutBtn").addEventListener("click", ()=>{ alert("Checkout flow demo — integrate payment/checkout here."); });

/* suggestions for quick view & add from product grid */
document.body.addEventListener("click", (e) => {
  const add = e.target.closest(".addBtn");
  if(add){ addToCart(Number(add.dataset.id)); return; }
  const qv = e.target.closest(".quick, .viewBtn");
  if(qv){ openQuickView(Number(qv.dataset.id)); return; }
});

/* small helpers */
document.getElementById("clearCart").addEventListener("click", ()=>{ if(confirm("Clear cart?")){ state.cart={}; saveCart(); }});
document.getElementById("miniSearch").value = state.search || "";
document.getElementById("miniSearch").placeholder = "Search products...";
document.getElementById("accountBtn").addEventListener("click", ()=> alert("Account demo — implement auth here."));

/* initial render */
renderProducts();
updateCartUI();

/* small keyboard UX: esc to close overlays */
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape"){
    closeCart();
    closeQuick();
    searchOverlay.classList.remove("open");
  }
});
/* safe number fallback for price sorting glitch (typo earlier) */
</script>
</body>
</html>
